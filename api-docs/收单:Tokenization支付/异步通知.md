# 异步通知 (Tokenization Async Notification)

## Endpoint
```
POST https://pay-gate-uat.payermax.com/tokenizationNotifyUrl
```

## Request Headers

| Parameter | Type | Required | Description | Example |
|-----------|------|----------|-------------|---------|
| Content-Type | string | required | - | application/json |
| sign | string | required | 签名信息请参考技术文档 | FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A== |

## Request Body (Callback from PayerMax)

**Content-Type:** `application/json`

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| code | string | required | 返回码，'APPLY_SUCCESS'代表成功 | <= 32 characters |
| msg | string | required | 响应描述，'Success.' | <= 256 characters |
| appId | string | optional | 商户app id | <= 64 characters |
| merchantNo | string | required | 商户Id | <= 15 characters |
| keyVersion | string | required | 密钥版本。当前值为：1 | <= 8 characters |
| notifyTime | string | required | 通知时间，符合rfc3339规范，格式：yyyy-MM-dd'T'HH:mm:ss.SSSXXX | <= 32 characters |
| notifyType | string | required | 通知类型 TOKENIZATION | <= 16 characters |
| data | object | required | 请求数据体 | - |

### data Object

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| userId | string | required | 商户内部的的用户号，必须唯一 | <= 64 characters |
| paymentTokenID | string | required | PMMax token | <= 64 characters |
| tokenScope | string | required | 适用范围 | <= 16 characters, Allowed: tokenAcq, tokenRec, tokenLink |
| paymentTokenExpiry | string | required | token有效期，符合rfc3339规范，格式：yyyy-MM-dd'T'HH:mm:ss.SSSXXX | <= 32 characters |
| paymentTokenStatus | string | required | token状态，卡token支付时，此字段为必填 | <= 16 characters, Allowed: Deleted, Activated, Expired |
| paymentMethodType | string | required | 支付方式类型，值为CARD、ONE_TOUCH等 | <= 32 characters |
| targetOrg | string | optional | 目标机构，当paymentMethodType不是CARD时，值为DANA、GCASH等，paymentMethodType为CARD时，targetOrg为空字符串 | <= 32 characters |
| country | string | required | 国家编码 | - |
| requestId | string | required | token申请单号，最新回调版本返回字段 | - |
| supportMIT | boolean | required | token是否支持MIT的标识 | - |
| status | string | required | token申请状态 | Allowed: SUCCESS, FAILED |
| cardInfo | string | optional | 掩码卡号，按照前6后4脱敏，如533333**2222 | <= 19 characters |
| ifCVV | string | optional | 是否需要CVV。Y: 使用Token支付时需要再次输入CVV; N:使用Token支付时不需要再次输入CVV。注：根据发卡行规则存在再次验证CVV的情况 | <= 1 character |
| brand | string | optional | 卡组，如Visa，Mastercard，双标卡则都返回 | <= 32 characters |
| outTradeNo | string | optional | 原支付交易对应的商户订单号。只有当第一次授权绑卡支付成功后的通知接口中返回改字段。paymentTokenStatus 状态发生变更再次通知商户时，该字段为空。 | <= 64 characters |
| accountDisplay | string | optional | 掩码授权账号，如63-9****72123，paymentMethodType为CARD时，accountDisplay为空字符串，paymentMethodType值不是CARD时，显示掩码授权账号 | - |
| referralCode | string | optional | token绑定唯一标识 | - |

**Example Request:**
```json
{
  "code": "APPLY_SUCCESS",
  "msg": "Success.",
  "appId": "your_app_id",
  "merchantNo": "your_merchant_no",
  "keyVersion": "1",
  "notifyTime": "2025-01-07T13:15:90.386Z",
  "notifyType": "TOKENIZATION",
  "data": {
    "userId": "user_12345",
    "paymentTokenID": "token_abc123",
    "tokenScope": "tokenAcq",
    "paymentTokenExpiry": "2026-01-07T13:15:90.386Z",
    "paymentTokenStatus": "Activated",
    "paymentMethodType": "CARD",
    "targetOrg": "",
    "country": "US",
    "requestId": "req_123456",
    "supportMIT": true,
    "status": "SUCCESS",
    "cardInfo": "533333**2222",
    "ifCVV": "N",
    "brand": "Visa",
    "outTradeNo": "merchant_order_123",
    "accountDisplay": "",
    "referralCode": "ref_code_123"
  }
}
```

## Response (Merchant Response to PayerMax)

### 200 OK

**Content-Type:** `application/json`

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| code | string | required | 响应 'SUCCESS' | <= 32 characters |
| msg | string | optional | 响应 'Success' | - |

**Example Response:**
```json
{
  "code": "SUCCESS",
  "msg": "Success"
}
```
