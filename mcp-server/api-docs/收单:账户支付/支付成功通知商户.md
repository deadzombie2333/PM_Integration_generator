# 支付成功通知商户 (Payment Success Notification to Merchant)

## Endpoint
```
POST https://pay-gate-uat.payermax.com/collectResultNotifyUrlForBillPayment
```

## Description
对客扣款成功后，PayerMax会自动入账并将调用该接口通知商户入账结果，商户可仅响应code和msg，无需响应data。

**注：** 如商户希望PayerMax先不处理入账，可联系PayerMax进行相应配置。配置完成后，PayerMax 会根据商户的入账结果进行处理，方式有如下两种：
1. 商户可同步响应入账结果，即接收到该通知后，可将入账确认结果响应到data中。
2. 商户可异步通知PayerMax入账结果，即调用PayerMax提供的商户入账结果确认接口。

## Request Headers

| Parameter | Type | Required | Description | Example |
|-----------|------|----------|-------------|---------|
| Content-Type | string | required | - | application/json |
| sign | string | required | 签名信息请参考技术文档 | FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A== |

## Request Body (Callback from PayerMax)

**Content-Type:** `application/json`

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| code | string | required | 返回码 | <= 8 characters |
| msg | string | required | 返回描述 | <= 256 characters |
| keyVersion | string | required | 密钥版本。当前值为：1 | <= 8 characters |
| merchantAppId | string | required | 商户应用Id，PayerMax分配给商户应用的唯一标识 | <= 64 characters |
| merchantNo | string | required | 商户号，商户与PayerMax业务签约时生成的唯一标识 | <= 32 characters |
| notifyTime | string | required | 通知时间，符合rfc3339规范，格式：yyyy-MM-dd'T'HH:mm:ss.SSSXXX | <= 32 characters |
| notifyType | string | required | 通知类型REPAYMENT_RECEIPT | <= 16 characters |
| data | object | required | - | - |

### data Object

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| tradeToken | string | required | PayerMax订单号。 | <= 64 characters |
| outTradeNo | string | required | 订单号。注：该单号由PayerMax生成。 | <= 64 characters |
| referenceNo | string | required | 商户的还款合同号，其中前五位由PayerMax生成。 | <= 64 characters |
| payStatus | string | required | 支付状态. PAY_SUCCESS | <= 32 characters |
| totalAmount | number | required | 订单金额。 | - |
| currency | string | required | 订单币种。 | <= 3 characters |
| completeTime | string | required | 用户真实付款的时间。 | <= 32 characters |
| paymentSucceedTime | string | optional | 支付完成时间。 | <= 32 characters |
| payerMobileNumber | string | required | 付款人手机号。 | <= 64 characters |
| payerEmail | string | optional | 付款人邮箱。 | <= 64 characters |
| paymentDetails | array[object] | required | 支付详情。 | - |

## Response (Merchant Response to PayerMax)

### 200 OK

**Content-Type:** `application/json`

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| code | string | required | 返回码，'SUCCESS'代表成功 | Example: SUCCESS |
| msg | string | required | 返回描述，'Success' | Example: Success |
| data | object | optional | 响应data。注：本data体可选填，但如果返回了data，data内的各字段类型和必填性描述如下。 | - |

### data Object (Optional)

| Parameter | Type | Required | Description | Constraints |
|-----------|------|----------|-------------|-------------|
| referenceNo | string | required | 商户的还款合同号，其中前五位由PayerMax生成。 | <= 64 characters |
| tradeToken | string | required | PayerMax订单号。 | <= 64 characters |
| amount | number | required | 订单金额 | - |
| currency | string | required | 订单币种 | <= 3 characters |
| confirmation | string | required | 商户入账确认的结果。"Y"或"N"。注：为N时PayerMax不会对该笔做结算。 | <= 16 characters |
| failureReason | string | optional | 商户入账确认失败的原因。注意：confirmation为N时，该值必填。 | <= 255 characters |

**Example Response (Simple):**
```json
{
  "code": "SUCCESS",
  "msg": "Success"
}
```

**Example Response (With Confirmation):**
```json
{
  "code": "SUCCESS",
  "msg": "Success",
  "data": {
    "referenceNo": "12345ABC123",
    "tradeToken": "T2025020713159038685354",
    "amount": 1000.00,
    "currency": "PHP",
    "confirmation": "Y"
  }
}
```

**Example Response (With Rejection):**
```json
{
  "code": "SUCCESS",
  "msg": "Success",
  "data": {
    "referenceNo": "12345ABC123",
    "tradeToken": "T2025020713159038685354",
    "amount": 1000.00,
    "currency": "PHP",
    "confirmation": "N",
    "failureReason": "Account verification failed"
  }
}
```
