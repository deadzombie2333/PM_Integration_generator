# 支付结果通知 (Payment Result Notification)

## API Information

- **Method**: POST (Callback from PayerMax)
- **Endpoint**: `https://pay-gate-uat.payermax.com/collectResultNotifyUrl`
- **Content-Type**: `application/json`

## Description

支付完成后，PayerMax 会把相关支付结果通过数据流的形式发送给商户，商户需要接收处理，并按文档规范返回应答。

**重要提示**：
- 该地址无需商户主动请求
- 以下request.body为PayerMax对订单状态的回调内容
- 商户收到回调后需要响应：`{"msg": "Success","code": "SUCCESS"}`

## Request Headers (from PayerMax)

| Header | Type | Required | Description | Example |
|--------|------|----------|-------------|---------|
| Content-Type | string | ✓ | Request content type | `application/json` |
| sign | string | ✓ | 签名信息请参考技术文档 | `FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A==` |

## Request Body (Callback from PayerMax)

### Root Level Parameters

| Parameter | Type | Required | Max Length | Description |
|-----------|------|----------|------------|-------------|
| code | string | ✓ | 32 | 返回码，交易成功时，code:APPLY_SUCCESS 且status：SUCCESS; 交易失败，code会返回交易失败错误码 且status为FAILED或CLOSED。 |
| msg | string | ✓ | 256 | 返回描述，交易成功时，msg:Success. 且status：SUCCESS; 交易失败，msg会返回交易失败错误msg 且status为FAILED或CLOSED。 |
| keyVersion | string | ✓ | 8 | 密钥版本。当前值为：1 |
| appId | string | ✓ | 64 | 商户app id |
| merchantNo | string | ✗ | 15 | 商户Id |
| notifyTime | string | ✓ | 32 | 通知时间，符合rfc3339规范，格式：yyyy-MM-dd'T'HH:mm:ss.SSSXXX |
| notifyType | string | ✓ | 16 | 通知类型 PAYMENT |
| data | object | ✓ | - | 数据体 |

### Data Object Parameters

| Parameter | Type | Required | Max Length | Description |
|-----------|------|----------|------------|-------------|
| outTradeNo | string | ✓ | 64 | 商户订单号 |
| tradeToken | string | ✓ | 64 | PayerMax交易流水号 |
| totalAmount | number | ✓ | - | 商户传入的订单金额，金额的单位为元 |
| currency | string | ✓ | 3 | 标价币种 |
| country | string | ✗ | 2 | 用户支付的国家代码，大写字母 |
| status | string | ✓ | 32 | 交易状态：SUCCESS-支付成功，FAILED -支付失败，CLOSED-关单 |
| completeTime | string | ✓ | - | 完成时间，utc+0时区 |
| paymentDetails | array[object] | ✗ | - | 支付信息 |
| fees | object | ✗ | - | 费用信息，支付成功且存在费用时才返回 |
| reference | string | ✗ | 512 | 商户自定义附加数据，回调中原样返回 |
| channelNo | string | ✗ | 64 | 渠道订单号 |
| thirdChannelNo | string | ✗ | 64 | 三方单号 |
| paymentCode | string | ✗ | 64 | VA单号 |

### Status Values

| Value | Description |
|-------|-------------|
| SUCCESS | 支付成功 |
| FAILED | 支付失败 |
| CLOSED | 关单 |

## Response (200) - Merchant Response to PayerMax

### Response Body

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| code | string | ✓ | 仅可响应 'SUCCESS'(仅代表成功收到通知,不代表订单状态) |
| msg | string | ✓ | 响应 'Success'(仅代表成功收到通知,不代表订单状态) |

### Example Response

```json
{
  "code": "SUCCESS",
  "msg": "Success"
}
```

## Notes

- ✓ = Required field
- ✗ = Optional field
- 这是一个回调接口，由PayerMax主动调用商户的notifyUrl
- 商户必须验证签名以确保回调来自PayerMax
- 商户必须返回正确的响应格式，否则PayerMax会重试回调
- 交易成功时：code为APPLY_SUCCESS且status为SUCCESS
- 交易失败时：code为错误码且status为FAILED或CLOSED
