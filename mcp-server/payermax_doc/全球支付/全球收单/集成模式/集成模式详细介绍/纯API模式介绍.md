# 纯API模式介绍

商户希望在自己的收银台上给用户展示支付方式并支付，PayerMax提供纯API（Direct API）的方式接入。与收银台模式最大的差别在于，用户不需要跳转PayerMax页面。

## 1. 适用性

- ✅ 商户希望自己控制收银台，最大程度的在其自己的页面完成支付交互
- ✅ 商户有较强的开发能力，新增支付方式需要对接，有开发联调工作

## 2. 用户流程介绍

### 2.1 卡支付

商户自行构建收银台，用户选择卡支付，在页面填写卡信息后，确认支付后，商户调用PayerMax进行支付。

**流程图：**
```
商户收银台 → [用户选择卡支付] → 商户页面填写卡信息 → 确认支付 → 调用PayerMax API → 完成支付
```

**特点：**
- 商户自建收银台页面
- 用户在商户页面输入卡信息
- 商户需要PCI-DSS认证（如果处理卡信息）
- 完全控制支付流程和UI

**注意事项：**
- ⚠️ 商户服务器处理卡信息需要PCI-DSS认证
- ⚠️ 需要实现完整的卡信息输入表单
- ⚠️ 需要处理卡验证逻辑
- ⚠️ 需要处理3DS验证流程

### 2.2 钱包支付

商户自行构建收银台，用户选择支付方式进行支付，商户拉起PayerMax返回的钱包支付页面，用户在钱包页面完成支付。

**流程图：**
```
商户收银台 → [用户选择钱包支付] → 调用PayerMax API → 获取钱包跳转URL → 跳转钱包页面 → 完成支付
```

**特点：**
- 商户展示支付方式列表
- 用户在商户页面选择钱包
- 跳转到钱包机构页面（如支付宝、微信等）
- 无需PCI-DSS认证

**支持的钱包类型：**
- 支付宝（Alipay）
- 微信支付（WeChat Pay）
- GrabPay
- GCash
- Dana
- OVO
- 其他本地钱包

**注意：**
商户也可通过收银台模式指定支付方式的方式实现此类交互。

## 3. 纯API模式 vs 收银台模式

| 对比维度 | 纯API模式 | 收银台模式 |
|---------|----------|-----------|
| **页面控制** | 商户完全控制 | PayerMax提供 |
| **用户体验** | 无需跳转（卡支付） | 需要跳转 |
| **开发成本** | 高 | 低 |
| **UI定制** | 完全自定义 | 有限定制 |
| **PCI-DSS** | 需要（卡支付） | 不需要 |
| **新支付方式** | 需要开发对接 | 自动支持 |
| **维护成本** | 高 | 低 |
| **适用场景** | 有开发能力，需要深度定制 | 快速集成，降低成本 |

## 4. 技术要求

### 4.1 开发能力要求

**前端开发：**
- 构建完整的收银台UI
- 实现支付方式选择逻辑
- 处理卡信息输入表单（卡支付）
- 实现支付状态管理
- 处理跳转和回调

**后端开发：**
- 调用PayerMax API接口
- 处理签名验证
- 管理订单状态
- 处理异步通知
- 实现重试机制

### 4.2 安全要求

**卡支付场景：**
- 🔒 需要PCI-DSS认证
- 🔒 安全存储和传输卡信息
- 🔒 实现3DS验证
- 🔒 防止卡信息泄露

**钱包支付场景：**
- ✅ 无需PCI-DSS认证
- ✅ 不处理敏感信息
- ✅ 只需处理跳转逻辑

### 4.3 集成工作量

**初次集成：**
- 开发时间：3-5天
- 前端工作：中等
- 后端工作：中等
- 测试工作：较多

**新增支付方式：**
- 需要开发对接
- 需要联调测试
- 需要UI适配
- 持续维护成本

## 5. 适用场景

### ✅ 推荐使用场景

**卡支付：**
- 已有PCI-DSS认证
- 需要完全控制支付流程
- 希望用户无需跳转
- 有专业的支付开发团队

**钱包支付：**
- 需要自定义支付方式展示
- 希望控制支付方式排序
- 需要特殊的业务逻辑
- 有较强的开发能力

### ⚠️ 不推荐场景

- 无PCI-DSS认证但需要卡支付
- 开发资源有限
- 希望快速上线
- 频繁新增支付方式
- 无专业支付开发团队

## 6. 实现方式对比

### 6.1 卡支付实现

**纯API模式：**
```javascript
// 商户页面收集卡信息
const cardInfo = {
  cardNumber: "4111111111111111",
  cvv: "123",
  expiryMonth: "12",
  expiryYear: "2025"
};

// 调用PayerMax API
const response = await payermax.pay({
  paymentMethod: "CARD",
  cardInfo: cardInfo,
  // ... 其他参数
});
```

**收银台模式：**
```javascript
// 只需获取跳转链接
const response = await payermax.createOrder({
  // ... 订单参数
});

// 跳转到PayerMax收银台
window.location.href = response.redirectUrl;
```

### 6.2 钱包支付实现

**纯API模式：**
```javascript
// 商户页面展示支付方式
<button onClick={() => pay('ALIPAY')}>支付宝</button>
<button onClick={() => pay('WECHAT')}>微信支付</button>

// 调用API获取跳转链接
const response = await payermax.pay({
  paymentMethod: selectedMethod,
  // ... 其他参数
});

// 跳转到钱包页面
window.location.href = response.redirectUrl;
```

**收银台模式（指定支付方式）：**
```javascript
// 商户页面展示支付方式
<button onClick={() => pay('ALIPAY')}>支付宝</button>

// 调用API并指定支付方式
const response = await payermax.createOrder({
  paymentMethod: 'ALIPAY',
  // ... 其他参数
});

// 跳转到PayerMax收银台（已指定支付方式）
window.location.href = response.redirectUrl;
```

## 7. 开发注意事项

### 7.1 卡支付注意事项

1. **PCI-DSS合规**
   - 确保已获得PCI-DSS认证
   - 不要在日志中记录完整卡号
   - 使用HTTPS传输
   - 实现安全的卡信息存储

2. **卡信息验证**
   - 实现Luhn算法验证卡号
   - 验证CVV格式
   - 验证有效期
   - 实时反馈验证结果

3. **3DS处理**
   - 支持3DS验证流程
   - 处理3DS回调
   - 展示3DS验证页面

### 7.2 钱包支付注意事项

1. **支付方式管理**
   - 动态获取可用支付方式
   - 根据国家/地区过滤
   - 支持支付方式图标展示

2. **跳转处理**
   - 正确处理跳转URL
   - 支持移动端唤起APP
   - 处理跳转失败场景

3. **回调处理**
   - 实现前端回调页面
   - 处理异步通知
   - 验证支付结果

## 8. 最佳实践

### 8.1 用户体验优化

- 清晰展示支付方式
- 提供支付引导
- 实时反馈支付状态
- 优化加载速度
- 支持多语言

### 8.2 错误处理

- 友好的错误提示
- 支持重试机制
- 记录错误日志
- 提供客服入口

### 8.3 性能优化

- 缓存支付方式列表
- 预加载支付资源
- 优化API调用
- 减少不必要的请求

## 9. 下一步

- 查看[纯API模式集成文档](https://docs.payermax.com/api/integration)
- 体验[在线DEMO](https://demo.payermax.com/api)
- 了解[API接口文档](https://docs.payermax.com/api-reference)
- 查看[PCI-DSS合规指南](https://docs.payermax.com/security/pci-dss)
- 下载[SDK](https://github.com/PayerMax)
