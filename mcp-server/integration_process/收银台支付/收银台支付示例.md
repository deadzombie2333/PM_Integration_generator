# 收银台支付示例

本文档提供不同支付场景下的完整请求和响应示例。

## 示例1: 使用所有支付方式

### 场景说明
- 不指定支付方式
- 展示所有可用的支付方式
- 用户可以自由选择

### 请求示例

```bash
curl --request POST \
  --url https://pay-gate-uat.payermax.com/aggregate-pay/api/gateway/orderAndPay \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'sign: FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A==' \
  --data '{
    "version": "1.4",
    "keyVersion": "1",
    "requestTime": "2025-05-14T06:29:50.085+00:00",
    "appId": "testb427ca0ef77d19bd25c83",
    "merchantNo": "TEST081764",
    "data": {
      "outTradeNo": "PTEST93137249",
      "subject": "diamond 700",
      "totalAmount": 3.99,
      "currency": "USD",
      "country": "US",
      "userId": "1800110891",
      "language": "en",
      "frontCallbackUrl": "https://your-payment.example.com/payment/front_callback?flag=ipaMbjQuest",
      "notifyUrl": "https://your-payment.example.com/payment/payment_callback",
      "reference": "your special info",
      "integrate": "Hosted_Checkout",
      "expireTime": "1200"
    }
  }'
```

### 关键参数说明

- `language`: "en" - 指定PayerMax收银页展示英语
- `frontCallbackUrl`: 用户支付完成后跳转的商户页面
- `notifyUrl`: 支付结果回调通知URL
- `reference`: "your special info" - 自定义附加数据，回调时会返回
- `expireTime`: "1200" - 设定该笔支付的过期时间为1200秒（20分钟）

### 响应示例

```json
{
  "msg": "Success.",
  "code": "APPLY_SUCCESS",
  "data": {
    "redirectUrl": "https://cashier-n.payermax.com/v2/index.html#/payments?merchantId=TEST081764&merchantAppId=testb427ca0ef77d19bd25c83&country=US&tradeToken=T2019051406423972799219&language=en&token=358746abf4754e1cba682d1391336734&amount=3.99&currency=USD&version=1.4&cashierId=T2019051406423972799219&frontCallbackUrl=https%3A%2F%2Fyour-payment.example.com%2Fpayment%2Ffront_callback%3Fflag%3DipaMbjQuest&pmaxLinkV=1",
    "outTradeNo": "PTEST93137249",
    "tradeToken": "T2019051406423972799219",
    "status": "PENDING"
  }
}
```

## 示例2: 使用电子钱包支付方式

### 场景说明
- 指定支付方式为电子钱包（WALLET）
- 不指定具体支付机构
- 展示该国家所有可用的电子钱包

### 请求示例

```bash
curl --request POST \
  --url https://pay-gate-uat.payermax.com/aggregate-pay/api/gateway/orderAndPay \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'sign: FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A==' \
  --data '{
    "version": "1.4",
    "keyVersion": "1",
    "requestTime": "2025-05-14T17:25:39.064+08:00",
    "appId": "test7e94124c208abbfc7e2792ecfa",
    "merchantNo": "TEST0114787283",
    "data": {
      "outTradeNo": "TEST39627390559111746827473769",
      "integrate": "Hosted_Checkout",
      "subject": "IDR 53,000",
      "totalAmount": "53000",
      "currency": "IDR",
      "country": "ID",
      "userId": "1177295",
      "frontCallbackUrl": "https://www.your.com",
      "notifyUrl": "https://middlepay.your.com/api_server/v2/finance/callback/order/TEST39627390559111746827473769",
      "paymentDetail": {
        "paymentMethodType": "WALLET",
        "targetOrg": ""
      }
    }
  }'
```

### 关键参数说明

- `country`: "ID" - 印度尼西亚
- `currency`: "IDR" - 印尼盾
- `paymentDetail.paymentMethodType`: "WALLET" - 指定支付方式为电子钱包
- `paymentDetail.targetOrg`: "" - 不指定支付机构

### 效果说明

支付国家是印度尼西亚，同时指定支付方式是电子钱包，则PayerMax收银页会展示支持的印尼电子钱包，如：
- DANA
- OVO
- GOPAY
- 其他印尼电子钱包

### 响应示例

```json
{
  "msg": "Success.",
  "code": "APPLY_SUCCESS",
  "data": {
    "redirectUrl": "https://cashier-n.payermax.com/v2/index.html#/payments?merchantId=TEST0114787283&merchantAppId=test7e94124c208abbfc7e2792ecfa&country=ID&tradeToken=T2019051409242877928306&paymentMode=WALLET&language=id&token=3acc37542e204765a6d11b86bf0bc930&amount=53000&currency=IDR&version=1.4&cashierId=T2019051409242877928306&frontCallbackUrl=https%3A%2F%2Fwww.your.com&pmaxLinkV=1",
    "outTradeNo": "TEST39627390559111746827473769",
    "tradeToken": "T2019051409242877928306",
    "status": "PENDING"
  }
}
```

## 示例3: 使用指定电子钱包机构

### 场景说明
- 指定支付方式为电子钱包（WALLET）
- 指定具体支付机构为GCASH
- 直接使用GCASH支付

### 请求示例

```bash
curl --request POST \
  --url https://pay-gate-uat.payermax.com/aggregate-pay/api/gateway/orderAndPay \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'sign: FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A==' \
  --data '{
    "merchantNo": "TEST894366",
    "version": "1.4",
    "keyVersion": "1",
    "requestTime": "2025-05-14T06:30:02.844Z",
    "appId": "testf64019bf1e63ee3fb364c5",
    "data": {
      "outTradeNo": "test_3934784",
      "integrate": "Hosted_Checkout",
      "userId": "test34784",
      "subject": "Number of Coins8200",
      "country": "PH",
      "currency": "USD",
      "totalAmount": "1.00",
      "frontCallbackUrl": "https://your-pay.vshowapi.com/payUrl/return/1747204201786_3934784",
      "expireTime": "1800",
      "reference": "payermax",
      "language": "en",
      "paymentDetail": {
        "paymentMethodType": "WALLET",
        "targetOrg": "GCASH"
      },
      "notifyUrl": "https://your-pay.vshowapi.com/callback/payermax",
      "terminalType": "WAP"
    }
  }'
```

### 关键参数说明

- `country`: "PH" - 菲律宾
- `paymentDetail.paymentMethodType`: "WALLET" - 电子钱包
- `paymentDetail.targetOrg`: "GCASH" - 指定使用GCASH
- `terminalType`: "WAP" - 移动网页端

### 响应示例

```json
{
  "msg": "Success.",
  "code": "APPLY_SUCCESS",
  "data": {
    "redirectUrl": "https://cashier-n.payermax.com/static/processing.html?merchantId=TEST894366&merchantAppId=testf64019bf1e63ee3fb364c5&tradeToken=T2019051406661275799086&country=PH&language=tl&token=0f5444f8f4b045a38f20632575498637&version=1.4&paymentMode=WALLET&targetOrg=GCASH&cashierRequestNo=T202505140666127579908620250514063002952415488&cashierId=T2019051406661275799086&orderLan=tl&countryLan=tl&strategyLan=LUBCO&pmaxLinkV=1",
    "outTradeNo": "test_3934784",
    "tradeToken": "T2019051406661275799086",
    "status": "PENDING"
  }
}
```

## 示例4: 使用卡支付并限定卡组织

### 场景说明
- 指定支付方式为卡支付（CARD）
- 限定只能使用MASTERCARD
- 只展示支持MASTERCARD的支付机构

### 请求示例

```bash
curl --request POST \
  --url https://pay-gate-uat.payermax.com/aggregate-pay/api/gateway/orderAndPay \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --header 'sign: FPFVT3o227JrFRbqu19boZCpVVTF9KznxyRawUmxpfXilHV/0yK46haPhAjNu1hPUMy7Vw/ILXhfzffNm4Fj0apWknlTY9OJxnSoQxS9BTFtc61tn5yV1q69x/kkBl82/qwg+XTJ4fOzy7Mar3VaC1E2PlDA6RkkKBUyNE6RYgsdB+Su7an4+4HVTNAnoe74WyvBgxTLMNg28igBTdqxaO3w/UBY6ObVp7vkqkQGdL1Y+HgmMYaAVwrM3+ALWGId0sJ+YqTY4WJ+0xCRGhaSnybiIjZsQEYyID68WNUfuavDLDsEhaMm/HfQvf5p0R1Ltovp3wwJnEbQcjY458iX5A==' \
  --data '{
    "version": "1.4",
    "keyVersion": 1,
    "requestTime": "2025-05-14T16:30:27.174+08:00",
    "appId": "test516e8ab74578be8eecd8c4803fbe",
    "merchantNo": "TEST010117960578",
    "data": {
      "outTradeNo": "test5141630270627",
      "integrate": "Hosted_Checkout",
      "subject": "US $4.99 Stargem",
      "totalAmount": 4.99,
      "currency": "USD",
      "country": "US",
      "frontCallbackUrl": "https://pay.your.com/official_v2/redirect/web_payermax_web_v1",
      "userId": "test_1743900006925",
      "reference": "gp_huq_u",
      "notifyUrl": "https://pay.your.com/official_v2/notify/web_payermax_web_v1",
      "paymentDetail": {
        "paymentMethodType": "CARD",
        "allowedCardOrg": [
          "MASTERCARD"
        ]
      }
    }
  }'
```

### 关键参数说明

- `paymentDetail.paymentMethodType`: "CARD" - 指定支付方式为卡支付
- `paymentDetail.allowedCardOrg`: ["MASTERCARD"] - 指定只能使用MASTERCARD

### 效果说明

当PayerMax渲染收银页时，只会展示支持MASTERCARD的支付机构。用户只能使用MASTERCARD品牌的卡进行支付。

如果需要支持多个卡组织，可以这样配置：
```json
"allowedCardOrg": ["MASTERCARD", "VISA", "AMEX"]
```

### 响应示例

```json
{
  "msg": "Success.",
  "code": "APPLY_SUCCESS",
  "data": {
    "redirectUrl": "https://cashier-n.payermax.com/v2/index.html#/payments?merchantId=TEST010117960578&merchantAppId=test516e8ab74578be8eecd8c4803fbe&orderNo=test5141630270627&country=US&tradeToken=T2019051408217377899667&paymentMode=CARD&targetOrg=*&token=acd8b556379140ee9a6ea067d6e68e35&amount=4.99&currency=USD&version=1.4&cashierId=T2019051408217377899667&frontCallbackUrl=https%3A%2F%2Fpay.your.com%2Fofficial_v2%2Fredirect%2Fweb_payermax_web_v1&pmaxLinkV=1",
    "outTradeNo": "test5141630270627",
    "tradeToken": "T2019051408217377899667",
    "status": "PENDING"
  }
}
```

## 常见支付方式类型

| 支付方式类型 | 说明 | 示例 |
|------------|------|------|
| CARD | 银行卡支付 | 信用卡、借记卡 |
| WALLET | 电子钱包 | GCASH、DANA、OVO、GOPAY |
| BANK_TRANSFER | 银行转账 | 网银转账 |
| CASH | 现金支付 | 便利店支付 |
| BNPL | 先买后付 | 分期付款 |

## 常见卡组织

| 卡组织代码 | 说明 |
|-----------|------|
| MASTERCARD | 万事达卡 |
| VISA | 维萨卡 |
| AMEX | 美国运通 |
| JCB | 日本信用卡 |
| DISCOVER | 发现卡 |

## 注意事项

1. **sign签名**: 示例中的sign仅为演示，实际使用时需要根据自己的密钥生成
2. **商户订单号**: outTradeNo必须在商户系统内唯一
3. **金额格式**: 不同货币的金额格式可能不同，注意小数位数
4. **回调地址**: 确保notifyUrl和frontCallbackUrl可以从外部访问
5. **测试环境**: 示例使用的是测试环境地址，生产环境需要更换
