# 收银台支付接口

## 接口概览

| 接口名称 | 接口PATH | 请求方法 | 调用方向 | 说明 |
|---------|----------|---------|---------|------|
| 创建支付 | /orderAndPay | POST | 商户 -> PayerMax | 创建支付订单并获取收银台URL |
| 支付结果通知 | /collectResultNotifyUrl | POST | PayerMax -> 商户 | 异步通知支付结果 |
| 查询支付交易 | /orderQuery | POST | 商户 -> PayerMax | 查询支付订单状态 |

## 创建支付接口

### 接口信息

- **接口PATH**: `/orderAndPay`
- **请求方法**: POST
- **Content-Type**: application/json
- **调用方向**: 商户 -> PayerMax

### 环境地址

- **测试环境**: `https://pay-gate-uat.payermax.com/aggregate-pay/api/gateway/orderAndPay`
- **生产环境**: `https://pay-gate.payermax.com/aggregate-pay/api/gateway/orderAndPay`

### 请求头

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| Accept | String | 是 | application/json |
| Content-Type | String | 是 | application/json |
| sign | String | 是 | 请求签名，用于验证请求合法性 |

### 请求参数

#### 公共参数

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| version | String | 是 | API版本号，如"1.4" |
| keyVersion | String | 是 | 密钥版本号 |
| requestTime | String | 是 | 请求时间，ISO 8601格式 |
| appId | String | 是 | 应用ID |
| merchantNo | String | 是 | 商户号 |
| data | Object | 是 | 业务数据对象 |

#### data对象参数

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| outTradeNo | String | 是 | 商户订单号，商户系统内唯一 |
| subject | String | 是 | 订单标题/商品描述 |
| totalAmount | Number | 是 | 订单总金额 |
| currency | String | 是 | 货币代码，如USD、IDR等 |
| country | String | 是 | 国家代码，如US、ID等 |
| userId | String | 是 | 用户ID |
| integrate | String | 是 | 集成模式，固定值"Hosted_Checkout" |
| language | String | 否 | 收银页展示语言，如en、id等 |
| frontCallbackUrl | String | 是 | 支付完成后跳转的商户页面URL |
| notifyUrl | String | 否 | 支付结果回调通知URL |
| reference | String | 否 | 自定义附加数据 |
| expireTime | String | 否 | 支付过期时间，单位秒，范围1800-86400 |
| terminalType | String | 否 | 终端类型，如WAP、APP等 |
| paymentDetail | Object | 否 | 支付方式详情 |

#### paymentDetail对象参数

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| paymentMethodType | String | 否 | 支付方式类型，如CARD、WALLET等 |
| targetOrg | String | 否 | 指定支付机构，如GCASH、DANA等 |
| allowedCardOrg | Array | 否 | 允许的卡组织列表，如["MASTERCARD", "VISA"] |

### 响应参数

| 参数名 | 类型 | 说明 |
|-------|------|------|
| code | String | 响应码，APPLY_SUCCESS表示成功 |
| msg | String | 响应消息 |
| data | Object | 响应数据对象 |

#### data对象参数

| 参数名 | 类型 | 说明 |
|-------|------|------|
| redirectUrl | String | PayerMax收银台页面URL |
| outTradeNo | String | 商户订单号 |
| tradeToken | String | PayerMax交易单号 |
| status | String | 订单状态，PENDING表示待支付 |

### 支付方式配置说明

#### 1. 不指定支付方式（展示所有）
不传 `paymentDetail` 参数，或传空对象。

#### 2. 指定支付方式类型
```json
"paymentDetail": {
  "paymentMethodType": "WALLET",
  "targetOrg": ""
}
```
- 只展示该支付方式下的所有支付机构
- 不展示其他支付方式

#### 3. 指定具体支付机构
```json
"paymentDetail": {
  "paymentMethodType": "WALLET",
  "targetOrg": "GCASH"
}
```
- 直接使用指定的支付机构
- 可能跳过收银台选择页面

#### 4. 指定卡支付和卡组织
```json
"paymentDetail": {
  "paymentMethodType": "CARD",
  "allowedCardOrg": ["MASTERCARD", "VISA"]
}
```
- 只展示支持指定卡组织的支付机构
- 可以限定用户使用特定品牌的卡

## 支付结果通知接口

### 接口信息

- **接口PATH**: 商户配置的回调地址
- **请求方法**: POST
- **Content-Type**: application/json
- **调用方向**: PayerMax -> 商户

详细信息请查看支付结果通知相关文档。

## 查询支付交易接口

### 接口信息

- **接口PATH**: `/orderQuery`
- **请求方法**: POST
- **Content-Type**: application/json
- **调用方向**: 商户 -> PayerMax

详细信息请查看支付订单查询相关文档。

## 错误码

常见错误码及处理方式请查看错误排查文档。

## 注意事项

1. **签名验证**: 所有请求必须包含正确的sign签名
2. **幂等性**: 使用相同的outTradeNo重复请求，返回相同结果
3. **超时处理**: 建议设置合理的请求超时时间
4. **重试机制**: 网络异常时可以重试，但要注意幂等性
5. **状态确认**: 不要依赖前端跳转的status参数，应通过回调或查询接口确认最终状态
